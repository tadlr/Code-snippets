!function(e){"use strict";var n,t={selector:"",dataattr:"src",background:!1,each:null,eacherror:null,callback:null,timeout:5e3},a=function(n,t,a,o){var i=n.currentTarget,u=e(i).data(n.namespace);u.isLoading&&(o?"function"==typeof u.eacherror?u.eacherror(t):null!==t.parentNode&&t.parentNode.removeChild(t):"function"==typeof u.each&&u.each(t,a),++u.loadedImageCounter,u.loadedImageCounter>=u.length&&r(i,n.namespace))},r=function(n,t){var r=e(n),o=r.data(),i=o[t].callback;r.off("loadImage."+t,a),delete o[t],"function"==typeof i&&setTimeout(function(){i(n)},2*e.imageloader.queueInterval)},o=function(n,t,a,r,o,i){var u=e(n),c=u.data(o),d=!1,l=function(r,i){u.removeAttr(["data-",o].join("")),e(t).triggerHandler("loadImage."+a,[n,i,r&&"error"===r.type])};return function(){var n,t=e("<img />");t.bind("error",function(t){d=!0,clearTimeout(n),e(this).unbind("error").unbind("load"),l(t)}).bind("load",function(a){d=!0,clearTimeout(n),e(this).unbind("error").unbind("load"),r?u.css("background-image",["url(",c,")"].join("")):u.attr("src",c),l(a,t[0])}).attr("src",c),n=setTimeout(function(){!1===d&&t.trigger("error")},i)}},i={getInstance:function(){return n instanceof u==!1&&(n=new u),n}},u=function(){this.index=0,this.queue=[],this.isRunning=!1};u.prototype.add=function(e){if("function"!=typeof e)throw new Error("you can only pass function.");this.queue.push(e)},u.prototype.run=function(n){var t=e.proxy(this.run,this);n=n||!1,this.isRunning&&!n||(this.isRunning=!0,this.queue[this.index++](),this.index<this.queue.length?setTimeout(function(){t(!0)},e.imageloader.queueInterval):this.isRunning=!1)},e.imageloader={queueInterval:17},e.fn.imageloader=function(n){return this.each(function(u,c){!function(n,u,c){var d,l=i.getInstance(),s=e(u),f=e.extend({},t,c||{}),h="_"+(""+(new Date).valueOf()).slice(-7),g=0;""===f.selector&&s.data(f.dataattr)?(d=s,g=1):g=(d=s.find([f.selector,"[data-",f.dataattr,"]"].join(""))).length,s.data(h,{each:f.each,eacherror:f.eacherror,callback:f.callback,isLoading:!0,loadedImageCounter:0,length:g}),0===g?r(u,h):(d.each(function(e,n){l.add(o(n,u,h,f.background,f.dataattr,f.timeout))}),s.on("loadImage."+h,a),l.run())}(0,c,n)})}}(jQuery);